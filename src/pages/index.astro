---
import IndexLayout from "../layouts/IndexLayout.astro";
import Button from "../components/Button.astro";
import ProjectCard from "../components/ProjectCard.astro";
import BlogCard from "../components/BlogCard.astro";
import { getCollection } from "astro:content";

// Get featured projects and recent blog posts
const allProjects = await getCollection("projects");
const featuredProjects = allProjects
  .filter((p) => p.data.featured)
  .sort((a, b) => a.data.order - b.data.order)
  .slice(0, 3);

const allPosts = await getCollection("blog", ({ data }) => !data.draft);
const recentPosts = allPosts
  .sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf())
  .slice(0, 3);
---

<IndexLayout
  title="Home"
  description="Developer portfolio of Alex Vig - Building modern web experiences"
>
  <!-- Hero Section -->
  <section class="container-custom py-20 md:py-32 relative bg-white">
    <div class="max-w-4xl">
      <div class="animate-slide-up">
        <span class="text-accent font-medium mb-4 block">Hello, I'm</span>
        <h1
          class="text-5xl md:text-7xl font-bold text-text-primary mb-6 leading-tight"
        >
          Alex <span class="gradient-text">Vig</span>
        </h1>
        <p
          class="text-xl md:text-2xl text-text-secondary mb-8 max-w-2xl leading-relaxed"
        >
          A passionate developer crafting beautiful, performant web experiences.
          I specialize in modern JavaScript frameworks and love turning complex
          problems into elegant solutions.
        </p>
        <div class="flex flex-wrap gap-4">
          <Button href="/projects" variant="primary" size="lg">
            View My Work
            <svg
              class="w-5 h-5"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M17 8l4 4m0 0l-4 4m4-4H3"></path>
            </svg>
          </Button>
          <Button href="/contact" variant="secondary" size="lg">
            Get in Touch
          </Button>
        </div>
      </div>
    </div>

    <!-- Decorative element -->
    <div
      class="absolute top-1/2 right-0 w-96 h-96 bg-accent/10 rounded-full blur-3xl -translate-y-1/2 pointer-events-none hidden lg:block"
    >
    </div>
  </section>

  <!-- Featured Projects Section -->
  {
    featuredProjects.length > 0 && (
      <section class="container-custom py-20 border-t border-border">
        <div class="flex items-end justify-between mb-12">
          <div>
            <span class="text-accent font-medium mb-2 block">
              Featured Work
            </span>
            <h2 class="text-3xl md:text-4xl font-bold text-text-primary">
              Selected Projects
            </h2>
          </div>
          <Button href="/projects" variant="ghost">
            View All →
          </Button>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          {featuredProjects.map((project, index) => (
            <ProjectCard project={project} featured={index === 0} />
          ))}
        </div>
      </section>
    )
  }

  <!-- Recent Blog Posts Section -->
  {
    recentPosts.length > 0 && (
      <section class="container-custom py-20 border-t border-border">
        <div class="flex items-end justify-between mb-12">
          <div>
            <span class="text-accent font-medium mb-2 block">
              From the Blog
            </span>
            <h2 class="text-3xl md:text-4xl font-bold text-text-primary">
              Latest Articles
            </h2>
          </div>
          <Button href="/blog" variant="ghost">
            View All →
          </Button>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
          {recentPosts.map((post) => (
            <BlogCard post={post} />
          ))}
        </div>
      </section>
    )
  }

  <!-- CTA Section -->
  <section class="container-custom py-20 border-t border-border">
    <div class="text-center max-w-2xl mx-auto">
      <h2 class="text-3xl md:text-4xl font-bold text-text-primary mb-6">
        Let's Work Together
      </h2>
      <p class="text-xl text-text-secondary mb-8">
        Have a project in mind? I'd love to hear about it. Let's create
        something amazing together.
      </p>
      <Button href="/contact" variant="primary" size="lg">
        Start a Conversation
      </Button>
    </div>
  </section>
</IndexLayout>

<script>
  // Motion One animations for the hero section
  import { animate } from "motion";

  function initAnimations() {
    const heroElements = document.querySelectorAll(".animate-slide-up");

    animate(
      heroElements,
      { opacity: [0, 1], y: [20, 0] },
      { duration: 0.6, easing: "ease-out" },
    );
  }

  // Run on initial load
  initAnimations();

  // Re-run after view transitions
  document.addEventListener("astro:page-load", initAnimations);
</script>
